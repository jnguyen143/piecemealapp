<!DOCTYPE html>
<html>

<head>
  <title>PieceMeal</title>
  <link rel="stylesheet" type="text/css" href='../static/stylesheets/style.css'>
</head>

<body>
  <div class="main-container">

    <div class="left-container">

      <img class="logo" src="../static/assets/logo.svg" />

      <form class="recipes" onsubmit="searchRecipes();return false;" method="GET">
        <p>Search for Recipes</p>

        <input type="text" id="recipe-input" placeholder="find potential recipes!" />

        <div class="filters">
          <p>Filter by:</p>
        </div>

        <select id="cuisine" name="cuisine">
          <option value="">Cuisine Type</option>
          <option value="African">African</option>
          <option value="American">American</option>
          <option value="British"> British </option>
          <option value="Cajun"> Cajun </option>
          <option value="Caribbean"> Caribbean </option>
          <option value="Chinese"> Chinese </option>
          <option value="EasternEuropean"> EasternEuropean </option>
          <option value="European"> European </option>
          <option value="French"> French </option>
          <option value="German"> German </option>
          <option value="Greek"> Greek </option>
          <option value="Indian"> Indian </option>
          <option value="Irish"> Irish </option>
          <option value="Italian"> Italian </option>
          <option value="Japanese"> Japanese </option>
          <option value="Jewish"> Jewish </option>
          <option value="Korean"> Korean </option>
          <option value="LatinAmerican"> Latin American </option>
          <option value="Mediterranean"> Mediterranean </option>
          <option value="Mexican"> Mexican </option>
          <option value="MiddleEastern"> Middle Eastern </option>
          <option value="Nordic"> Nordic </option>
          <option value="Southern"> Southern </option>
          <option value="Spanish"> Spanish </option>
          <option value="Thai"> Thai </option>
          <option value="Vietnamese"> Vietnamese </option>
        </select>

        <br>
        <select id="intolerance" name="intolerance">
          <option value="">Intolerance</option>
          <option value="Dairy">Dairy</option>
          <option value="Egg">Egg</option>
          <option value="Gluten">Gluten</option>
          <option value="Grain">Grain</option>
          <option value="Peanut">Peanut</option>
          <option value="Seafood">Seafood</option>
          <option value="Sesame">Sesame</option>
          <option value="Shellfish">Shellfish</option>
          <option value="Soy">Soy</option>
          <option value="Sulfite">Sulfite</option>
          <option value="Tree Nut">Tree Nut</option>
          <option value="Wheat">Wheat</option>
        </select>
        <br>
        <select id="diet" name="diet">
          <option value="">Diet</option>
          <option value="Gluten Free">Gluten Free</option>
          <option value="Ketogenic">Ketogenic</option>
          <option value="Vegetarian">Vegetarian</option>
          <option value="Lacto-Vegetarian">Lacto-Vegetarian</option>
          <option value="Ovo-Vegetarian">Ovo-Vegetarian</option>
          <option value="Vegan">Vegan</option>
          <option value="Pescetarian">Pescetarian</option>
          <option value="Paleo">Paleo</option>
          <option value="Primal">Primal</option>
          <option value="Low FODMAP">Low FODMAP</option>
          <option value="Whole30">Whole30</option>
        </select>
        <!-- <br>
        <select id="maxPrepTime" name="maxPrepTime">
          <option>Prep Time</option>
          <option value=15>15 minutes</option>
          <option value=30>30 minutes</option>
          <option value=60>1 hour</option>
          <option value=90>1.5 hours</option>
          <option value=120>2 hours</option>
        </select> -->

        <button type="submit" id="search-recipe-button" class="search-button">Search</button>
      </form>

      <form class="ingredients" onsubmit="searchIngredients();return false;" method="POST">
        <p>Search for Ingredients</p>
        <input type="text" name="searchIngredients" id="ingredient-input" placeholder="search for ingredients!" />
        <button type="submit" class="search-button">Search</button>
      </form>
    </div>
  </div>

  <div class="right-container">
    <div class="nav_menu">
      <a href="/">Home</a>
      <a href="/login" id="logged-out" value="False">Login</a>
      <a href="/signup">Register</a>
    </div>

    <div id="content" class="right-sub-container">
      <div id="search-data"></div>

    </div>

    <div class="right-sub-container" id="hideDiv">
      <!-- If incoming data is from search route, display within right sub-container -->
      {%if search%}
      <div class="header">
        <h1>Search results for "{{keyword}}"</h1>
      </div>

      {%if recipe_search%}

      {%if not recipes%}
      <div style="text-align: center;">
        <p>Oops! Unable to display recipes at this time</p>
      </div>
      {%else%}
      <div class="content">
        {%for recipe in recipes%}
        <div class="recipe">
          <div class="image">
            <img src='{{recipe["image"]}}' alt="recipe_image" width="100" height="100">
            <button type="submit" class="add-button">ADD</button>
          </div>
          <div class="description">
            <h2>{{recipe["name"]}}</h2>
            <p>{{recipe["summary"]}}</p>
          </div>
        </div>
        {%endfor%}
      </div>
      {%endif%}

      {%else%}

      {%if not ingredients%}
      <div style="text-align: center;">
        <p>Oops! Unable to display ingredients at this time</p>
      </div>
      {%else%}
      <div class="content">
        {%for ingredient in ingredients%}
        <div class="recipe">
          <div class="image">
            <img src='{{ingredient["image"]}}' alt="ingredient_image" width="100" height="100">
            <button type="submit" class="add-button">ADD</button>
          </div>
          <div class="description">
            <h2>{{ingredient["name"]}}</h2>
            <p>{{ingredient["summary"]}}</p>
          </div>
        </div>
        {%endfor%}
      </div>
      {%endif%}

      {%endif%}

      <!-- If incoming data is from index route, display based on if user is authorized -->
      {%else%}

      <div class="header">
        <h1>Welcome to pieceMeal</h1>
        <p>Rediscover your appetite by exploring more than 1,000,000+ recipes. You can start by
          checking out some of our most popular recipes below</p>

        {%if not recipes%}
        <div style="text-align: center;">
          <p>Oops! Unable to display recipes at this time</p>
        </div>
        {%else%}
        <div class="content">
          {%for recipe in recipes%}
          <div class="recipe">
            <div class="image">
              <img src='{{recipe["image"]}}' alt="recipe_image" width="100" height="100">
              <button type="submit" class="add-button">ADD</button>
            </div>
            <div class="description">
              <h2>{{recipe["name"]}}</h2>
              <p>{{recipe["summary"]}}</p>
            </div>
          </div>
          {%endfor%}
        </div>
        {%endif%}
      </div>
      {%endif%}
    </div>

    {% include "Toast.html" %}

    <!-- <script src="../static/modules/index.js" type="module"></script> -->
    <script>
      function searchRecipes() {
        let input = document.getElementById('recipe-input').value;
        let cuisine = document.getElementById('cuisine').value;
        let intolerance = document.getElementById('intolerance').value;
        let diet = document.getElementById('diet').value;
        // let maxPrepTime = document.getElementById('maxPrepTime').value;
        console.log(cuisine)
        console.log(intolerance)
        console.log(diet)

        // to hide the suggested recipes div
        let btn = document.getElementById('search-recipe-button');
        let hideDiv = document.getElementById('hideDiv');
        btn.onclick = function () {
          if (hideDiv.style.display !== "none") {
            hideDiv.style.display = "none";

          }
        }
        fetch('/api/recipe-info/search?' + new URLSearchParams({
          query: input,
          cuisines: [cuisine],
          intolerances: [intolerance],
          diets: [diet],
          // max_prep_time: maxPrepTime
        })).then(response => response.json()).then(response => {
          fetch('/search-recipes', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ recipes: response.recipes, input: input })
          }).then(response => response.text()).then(response => document.getElementById('search-data').innerHTML = response);

        });
      }
      function searchIngredients() {

        let ingredientInput = document.getElementById('ingredient-input').value;
        console.log(ingredientInput)
        fetch('/api/ingredient-info/search?' + new URLSearchParams({
          query: ingredientInput,
        })).then(response => response.json()).then(response => {
          console.log(response.error_message)
          fetch('/search-ingredients', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ ingredients: response.ingredients, input: input })
          }).then(response => response.text()).then(response => document.getElementById('search-data').innerHTML = response);

        });
      }



    </script>
</body>

</html>